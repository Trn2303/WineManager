@model IPagedList<WineManager.Models.Product>
@using PagedList.Mvc;
@using PagedList;

@{
    ViewBag.Title = "Danh sách sản phẩm";
}

<h2>Danh sách sản phẩm</h2>

<!-- Form lọc sản phẩm -->
@using (Html.BeginForm("Index", "Product", FormMethod.Get, new { id = "filterForm", style = "display:none;" }))
{
    <div class="row mb-3">
        <div class="col-md-3">
            <label>Loại sản phẩm</label>
            @Html.DropDownList("productType",
                               new SelectList(ViewBag.ProductTypes, "CatalogyID", "CatalogyName", ViewBag.CurrentProductType),
                               "Tất cả",
                               new { @class = "form-control" })
        </div>
        <div class="col-md-3">
            <label>Năm sản xuất</label>
            @Html.DropDownList("vintage",
                               new SelectList(ViewBag.Vintages, ViewBag.CurrentVintage),
                               "Tất cả",
                               new { @class = "form-control" })
        </div>
        <div class="col-md-3">
            <label>Region</label>
            @Html.DropDownList("region",
                               new SelectList(ViewBag.Regions, ViewBag.CurrentRegion),
                               "Tất cả",
                               new { @class = "form-control" })
        </div>
        <div class="col-md-3 align-self-end">
            <button type="submit" class="btn btn-primary">Lọc</button>
        </div>
    </div>
}

<div class="text-right mb-3">
    <button type="button" id="filterToggle" class="btn btn-secondary">
        <i class="fas fa-filter"></i> Lọc sản phẩm
    </button>
</div>

<!-- Danh sách sản phẩm -->
<table class="table">
    <tr>
        <th>@Html.DisplayNameFor(model => model.First().ProductName)</th>
        <th>@Html.DisplayNameFor(model => model.First().Price)</th>
        <th>@Html.DisplayNameFor(model => model.First().Quantity)</th>
        <th>@Html.DisplayNameFor(model => model.First().Vintage)</th>
        <th>@Html.DisplayNameFor(model => model.First().Image)</th>
        <th>@Html.DisplayNameFor(model => model.First().Region)</th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>@Html.DisplayFor(modelItem => item.ProductName)</td>
            <td>@Html.DisplayFor(modelItem => item.Price)</td>
            <td>@Html.DisplayFor(modelItem => item.Quantity)</td>
            <td>@Html.DisplayFor(modelItem => item.Vintage)</td>
            <td style="max-width:140px">
                @{
                    string ImgPath = "~/wwwroot/WineImages/" + item.Image;
                }
                <img src="@Url.Content(ImgPath)" width="100" class="img-thumbnail" />
                <br />
                @Html.DisplayFor(modelItem => item.Image)
            </td>
            <td>@Html.DisplayFor(modelItem => item.Region)</td>
            <td>
                <p>
                    @Html.ActionLink("Sửa", "Edit", new { id = item.ProductID }, new { @class = "btn btn-outline-success" })&nbsp;
                    @Html.ActionLink("Chi tiết", "Details", new { id = item.ProductID }, new { @class = "btn btn-outline-primary" })&nbsp;
                    @Html.ActionLink("Xóa", "Delete", new { id = item.ProductID }, new { @class = "btn btn-outline-danger" })&nbsp;
                </p>
            </td>
        </tr>
    }
</table>

<div class="text-center pagination justify-content-center">
    @Html.PagedListPager(Model, page => Url.Action("Index", new
    {
        page,
        productType = ViewBag.CurrentProductType,
        vintage = ViewBag.CurrentVintage,
        region = ViewBag.CurrentRegion
    }))
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>$(document).ready(function () {
        $("#filterToggle").click(function () {
            $("#filterForm").toggle(); 
        });
    });</script>